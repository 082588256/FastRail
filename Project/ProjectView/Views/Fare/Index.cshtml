@{
    ViewData["Title"] = "Quản lý giá vé";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="fare-management-section" style="padding: 60px 0;">
    <div class="container">
        <div class="block-title text-center">
            <div class="dot-line"></div>
            <p>Fare Management</p>
            <h2>Quản lý giá vé tuyến và chặng</h2>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-10">
                <h4 class="mb-3">Giá vé theo tuyến + chặng + hạng ghế</h4>
                <div class="row g-2">
                    <div class="col-md-2">
                        <input type="number" id="routeId" class="form-control" placeholder="ID Tuyến">
                    </div>
                    <div class="col-md-2">
                        <input type="number" id="segmentId" class="form-control" placeholder="ID Chặng">
                    </div>
                    <div class="col-md-2">
                        <select id="seatClass" class="form-control">
                            <option value="">-- Seat Class --</option>
                            <option value="Economy">Economy</option>
                            <option value="Business">Business</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select id="seatType" class="form-control">
                            <option value="">-- Seat Type --</option>
                            <option value="Soft">Soft</option>
                            <option value="Hard">Hard</option>
                            <option value="Window">Window</option>
                            <option value="Aisle">Aisle</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="number" id="basePrice" class="form-control" placeholder="Giá vé">
                    </div>
                    <div class="col-md-2 d-grid gap-2">
                        <button onclick="setFare()" class="btn btn-success">Cập nhật giá</button>
                        <button onclick="getFare()" class="btn btn-outline-primary">Xem giá</button>
                    </div>
                </div>
                <div class="mt-3">
                    <strong>Giá hiện tại:</strong>
                    <span id="currentFare">--</span>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        const fareApiBase = 'https://localhost:5014/api/fare';

        async function setFare() {
            const routeId = document.getElementById("routeId").value;
            const segmentId = document.getElementById("segmentId").value;
            const seatClass = document.getElementById("seatClass").value;
            const seatType = document.getElementById("seatType").value;
            const basePrice = document.getElementById("basePrice").value;

            if (!routeId || !segmentId || !seatClass || !seatType || !basePrice) {
                alert("Vui lòng nhập đầy đủ thông tin.");
                return;
            }

            const payload = {
                seatClass: seatClass,
                seatType: seatType,
                basePrice: parseFloat(basePrice)
            };

            const response = await fetch(`${fareApiBase}/route/${routeId}/segment/${segmentId}/fare`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert("✅ Cập nhật giá vé thành công!");
                getFare();
            } else {
                const err = await response.text();
                alert("❌ Lỗi: " + err);
            }
        }

        async function getFare() {
            const routeId = document.getElementById("routeId").value;
            const segmentId = document.getElementById("segmentId").value;
            const seatClass = document.getElementById("seatClass").value;
            const seatType = document.getElementById("seatType").value;

            if (!routeId || !segmentId || !seatClass || !seatType) {
                alert("Vui lòng nhập đầy đủ thông tin.");
                return;
            }

            const response = await fetch(`${fareApiBase}/route/${routeId}/segment/${segmentId}/fare?seatClass=${seatClass}&seatType=${seatType}`);

            if (response.ok) {
                const fare = await response.json();
                document.getElementById("currentFare").innerText = fare.basePrice.toLocaleString("vi-VN") + " VND";
            } else {
                document.getElementById("currentFare").innerText = "--";
            }
        }
    </script>
}
